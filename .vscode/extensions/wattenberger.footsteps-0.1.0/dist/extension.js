module.exports=function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=1)}([function(e,t){e.exports=require("vscode")},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{a(n.next(e))}catch(e){s(e)}}function h(e){try{a(n.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,h)}a((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.deactivate=t.activate=void 0;const o=i(0),s=i(2);t.activate=function(e){const t=new s.FootstepsProvider;o.commands.registerCommand("footsteps.skipBack",()=>{t.onTimeTravel(-1)}),o.commands.registerCommand("footsteps.skipForwards",()=>{t.onTimeTravel(1)}),o.commands.registerCommand("footsteps.skipBackSameFile",()=>{t.onTimeTravel(-1,"within-file")}),o.commands.registerCommand("footsteps.skipForwardsSameFile",()=>{t.onTimeTravel(1,"within-file")}),o.commands.registerCommand("footsteps.skipBackDifferentFile",()=>{t.onTimeTravel(-1,"across-files")}),o.commands.registerCommand("footsteps.skipForwardsDifferentFile",()=>{t.onTimeTravel(1,"across-files")}),o.commands.registerCommand("footsteps.toggleHighlightingLines",()=>n(this,void 0,void 0,(function*(){const e=o.workspace.getConfiguration("footsteps"),t=e.get("doHighlightChanges"),i=e.inspect("doHighlightChanges"),n=i&&void 0===i.workspaceValue;yield e.update("doHighlightChanges",!t,n)}))),o.commands.registerCommand("footsteps.clearChangesWithinFile",()=>{var e;const i=null===(e=null===o.window||void 0===o.window?void 0:o.window.activeTextEditor)||void 0===e?void 0:e.document;i&&t.onClearChangesWithinFile(i)}),o.workspace.onDidChangeTextDocument(e=>{t.onTextChange([...e.contentChanges],e.document)})},t.deactivate=function(){}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FootstepsProvider=void 0;const n=i(0),o=i(3);t.FootstepsProvider=class{constructor(){this.history=[],this.currentHistoryIndex=0,this.maxNumberOfChangesToRemember=10,this.maxNumberOfChangesToHighlight=6,this.decorationTypes=[],this.highlightColor="rgb(255, 99, 72)",this.doHighlightChanges=!0,this.highlightColorMaxOpacity=.6,this.doHighlightCurrentlyFocusedChunk=!0,this.clearDecoration=n.window.createTextEditorDecorationType({backgroundColor:"rgba(0,0,0,0.001)",isWholeLine:!0}),this.onSyncWithSettings(),this.createDecorationTypes(),n.window.onDidChangeActiveTextEditor(()=>{this.onHighlightChanges()}),n.window.onDidChangeTextEditorSelection(()=>{this.onHighlightChanges()}),n.workspace.onDidChangeConfiguration(e=>{e.affectsConfiguration("footsteps")&&(this.onSyncWithSettings(),this.createDecorationTypes())})}onSyncWithSettings(){const e=n.workspace.getConfiguration("footsteps");this.doHighlightChanges&&!e.doHighlightChanges&&this.clearChanges(),this.maxNumberOfChangesToRemember=e.maxNumberOfChangesToRemember,this.maxNumberOfChangesToHighlight=e.maxNumberOfChangesToHighlight,this.highlightColor=e.highlightColor,this.doHighlightChanges=e.doHighlightChanges,this.highlightColorMaxOpacity=e.highlightColorMaxOpacity,this.doHighlightCurrentlyFocusedChunk=e.doHighlightCurrentlyFocusedChunk}createDecorationTypes(){const e=e=>{const t=e/this.maxNumberOfChangesToHighlight;return this.highlightColorMaxOpacity*(1-t)};this.decorationTypes=new Array(this.maxNumberOfChangesToHighlight).fill(0).map((t,i)=>n.window.createTextEditorDecorationType({backgroundColor:[this.highlightColor.replace("rgb","rgba").replace(/\)/g,""),", ",e(i),")"].join(""),isWholeLine:!0}))}onHighlightChanges(){if(!this.doHighlightChanges)return;const e=n.window.activeTextEditor,t=(null==e?void 0:e.document.fileName)||"",i=this.getChangesInFile(t);this.doHighlightCurrentlyFocusedChunk||this.clearChanges();let s=[0,0];e&&e.selection&&(s=[e.selection.start.line,e.selection.end.line]),i.forEach(([e,t],i)=>{if(!this.doHighlightCurrentlyFocusedChunk){const e=[Math.min(...t),Math.max(...t)];if(e[0]<=s[0]&&e[1]>=s[1])return}o.onHighlightLine(t,this.decorationTypes[i])})}addChangeToHistory(e,t,i){this.currentHistoryIndex=0;const n=this.history.slice(0,this.maxNumberOfChangesToHighlight).findIndex(([i,n])=>i===e&&n.find(e=>t.includes(e)||t.includes(e-1)||t.includes(e+1))),o=[t.slice(-1)[0],i];if(-1!==n){const i=this.history[n][1],s=[...new Set([...t,...i])];this.history=[[e,s,o],...this.history.slice(0,n),...this.history.slice(n+1)]}else this.history=[[e,t,o],...this.history];this.history=this.history.slice(0,this.maxNumberOfChangesToRemember)}getChangesInFile(e){return this.history.filter(([t])=>t===e)}getChangesInOtherFiles(e){return this.history.filter(([t])=>t!==e)}onTimeTravel(e=0,t="any"){const i=n.window.activeTextEditor,o=(null==i?void 0:i.document.fileName)||"",s="any"===t?this.history:"within-file"===t?this.getChangesInFile(o):"across-files"===t?this.getChangesInOtherFiles(o):[];let r=this.currentHistoryIndex-e;r=Math.max(0,r),r=Math.min(r,s.length-1);const[h,a,l]=s[r];if(!a)return;this.currentHistoryIndex=r;const c=l[0],g=l[1]+1;this.onUpdateSelection(h,c,g)}onUpdateSelection(e,t,i){const o=n.window.activeTextEditor,s=new n.Position(t,i),r=new n.Selection(s,s),h=new n.Range(new n.Position(t,i),new n.Position(t,i));n.workspace.openTextDocument(n.Uri.file(e)).then(e=>{n.window.showTextDocument(e).then(()=>{o&&(o.selection=r,o.revealRange(h,2))})})}onTextChange(e,t){if(!e.length)return;this.history=this.history.map(t=>this.updateStepWithContentChanges(t,e));const i=e[0].text;if(!i||!i.replace(/[\n| ]/g,"").length)return;let n=new Set;e.forEach(({range:e,rangeLength:t,text:i})=>{const o=e.start.line,s=e.end.line-o+1,r=i.split("\n").length-1,h=t?e.end.line-e.start.line:0;new Array(s+r-h).fill(0).forEach((e,t)=>{n.add(o+t)})});const o=[...n],s=e.slice(-1)[0].range.end.character+1;this.addChangeToHistory(t.fileName,o,s),this.onHighlightChanges()}onClearChangesWithinFile(e){this.history=this.history.filter(([t,i])=>!(t===e.fileName)||(o.onHighlightLine(i,this.clearDecoration),!1)),this.clearChanges(),this.onHighlightChanges(),this.currentHistoryIndex=0}clearChanges(){this.decorationTypes.forEach(e=>e.dispose()),this.createDecorationTypes()}updateStepWithContentChanges([e,t,i],o){const s=n.window.activeTextEditor,r=null==s?void 0:s.document.fileName;if(e!==r)return[e,t,i];let h=[...t],a=i[0];o.forEach(({range:e,rangeLength:i,text:n})=>{if(t.slice(-1)[0]<t[0])return t;let o=0;const s=n.split("\n").length-1,r=i?e.end.line-e.start.line:0;o-=r,o+=s,a>e.start.line&&(a+=o),h=[...new Set(h.map(t=>t<=e.start.line?t:t+o))].sort()});const l=[a,i[1]];return[r,h,l]}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.onHighlightLine=void 0;const n=i(0);t.onHighlightLine=(e,t)=>{var i;if(!t)return;const o=n.window.activeTextEditor;if(!o)return;const s=(null===(i=n.window.activeTextEditor)||void 0===i?void 0:i.selection.active.line)||0,r=e.map(e=>{if(e===s)return;return new n.Range(new n.Position(e,0),new n.Position(e,500))}).filter(e=>e);o.setDecorations(t,r)}}]);
//# sourceMappingURL=extension.js.map